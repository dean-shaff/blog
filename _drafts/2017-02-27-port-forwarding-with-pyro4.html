---
layout: post
title: Port forwarding with Pyro4
date: '2017-02-27T07:51:00.001-08:00'
author: dshaff001
tags: 
modified_time: '2017-02-27T07:51:44.079-08:00'
blogger_id: tag:blogger.com,1999:blog-8551793629529973046.post-7041591411592600449
blogger_orig_url: http://deanshaff.blogspot.com/2017/02/port-forwarding-with-pyro4.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><a href="https://pythonhosted.org/Pyro4/">Pyro4</a>&nbsp;is one of the coolest Python libraries I've used in recent months. Through my work, I've gotten an opportunity to use this library quite extensively. I am working on a GUI that interacts with 3 disparate pieces of hardware. Commands get sent to servers, and information is relayed back. Before I started work on this software, the GUI software made direct connection to these hardware interfaces. This approach is not beneficial for a few reasons. First, it can take a while to connect and initialize these hardware controllers, which means that you might sit around for a few minutes before the GUI starts up. This is annoying from both a developer and end-user standpoint. Second, and perhaps most importantly, if the GUI crashes (which it did frequently when I started work on it), so do the connections to the hardware interfaces. In the case of one of the hardware servers, this meant that my team had to send an email to a support team to reinitialize the connection. This gets really tedious. Third, having server/client code mixed in with PyQt code is inherently not modular.<br /><div><br /></div><div>Pyro4 (or Pyro) allows me to solve all of these problems, with very little added code. I create a normal Python object that represents a hardware server, slap on some Pyro decorators, and suddenly I can make remote calls to that server. The main developer has done a fantastic job of documenting this project, in addition to providing some concise examples.</div><div><br /></div><div>In my use case, I haven't needed to run Pyro code in a truly remote context. This is because Pyro is simply holding open connections to other remote servers, which I access locally. In other words, I run Pyro servers locally, and access them locally as well. Recently, I have found the need to be able to run Pyro servers remotely, and access them remotely as well. Say I have two computers, 'local' (my laptop) and 'remote' (my home server). I have a server I want to create on remote, and control from local. I need to use ssh port forwarding to be able to access remote's Pyro nameserver. I'll forward port 2223 from local to port 2224 on remote, and create a nameserver on remote's port 2224 as follows:</div><div><br /></div><div>```</div><div>(local)$&gt; ssh -L 2223:localhost:2224 remote_address&nbsp;</div><div>(remote)$&gt; pyro4-ns -p 2224 &amp;&nbsp;</div><div><div>NS running on localhost:2224 (127.0.0.1)</div><div>Warning: HMAC key not set. Anyone can connect to this server!</div><div>URI = PYRO:Pyro.NameServer@localhost:2224</div></div><div>(remote)$&gt; python basic_pyro4_server.py -nsp 2224 -nsn localhost</div><div><div>Registering basic server on name server</div><div>Server name is BasicServer</div><div>Server registered at localhost:2224</div></div><div>```</div><div><br /></div><div>Now, back on local, I can access remotes nameserver as follows:</div><div><br /></div><div>```</div><div>(local)$&gt; ipython</div><div>$&gt;: import Pyro4&nbsp;</div><div>$&gt;: ns = Pyro4.locateNS(host='localhost', port=2223) # note that I use the local listening port!&nbsp;</div><div>$&gt;: ns.list()</div><div>{u'BasicServer': u'PYRO:obj_f182149fe08748aa920f7ffa53f2a5a3@localhost:37609',</div><div>u'Pyro.NameServer': u'PYRO:Pyro.NameServer@localhost:2224'}</div><div>$&gt;: basic_server_uri = ns.lookup("BasicServer")&nbsp;</div><div>$&gt;: basic_server_client = Pyro4.Proxy(basic_server_uri)</div><div>$&gt;: basic_server_client.name</div><div>... # long error message&nbsp;</div><div>&nbsp;CommunicationError: cannot connect: [Errno 111] Connection refused</div><div>```</div><div><br /></div><div>So I was able to access the remote nameserver, and even list the objects registered on it. When I tried to get the `name` attribute of my basic server client, I got a Connection Refused error. This is because I need to forward the objects port to remote. I can do this is as follows, in a new terminal window:</div><div><br /></div><div>```</div><div>(local)$&gt; ssh -L 37609:localhost:37609 remote_address&nbsp;</div><div>```</div><div><br /></div><div>Or if I don't actually want to login to remote, do the following:&nbsp;</div><div><br /></div><div>```</div><div>(local)$&gt; ssh -N -L 37609:localhost:37609 remote_address &amp;&nbsp;</div><div>```</div><div><br /></div><div>Now if I try to access the `name` attribute of my `basic_server_client` object, I should be able to!</div><div></div></div>